# 🏠 AI 房间改造助手

一个基于 AI 的智能房间改造工具，通过多步骤精细化处理，将凌乱的房间照片转换为专业、整洁的工作空间。

## ✨ 功能特性

- 🎯 **五步精细化流程**：场景分析 → 基础清理 → 深度整理 → 布局优化 → 添加道具
- 🤖 **智能场景分析**：AI 自动识别房间类型、现有物品和杂乱物品
- 🧹 **智能清理**：自动识别并清理贴纸、污渍、杂物等
- 🎨 **布局优化**：智能调整物品摆放，优化空间利用
- 🎁 **道具添加**：根据场景需求智能添加专业道具
- 🔄 **重新清理**：支持多次清理，直到满意为止
- 🎨 **科技简约 UI**：现代化的玻璃态设计风格

## 🛠️ 技术栈

### 前端
- HTML5 / CSS3 / JavaScript
- 自定义科技简约风格 UI
- 拖拽上传支持

### 后端
- Node.js + Express.js
- Multer（文件上传处理）
- Axios（HTTP 请求）

### AI 服务
- **通义千问（Qwen）** - 主要 AI 服务（推荐）
- Stability AI - 备选方案
- OpenAI DALL-E - 备选方案

## 📦 安装

### 1. 克隆项目

```bash
git clone https://github.com/your-username/app-image-maker.git
cd app-image-maker
```

### 2. 安装依赖

```bash
npm install
```

### 3. 配置环境变量

在项目根目录创建 `.env` 文件：

```env
# 通义千问配置（推荐）
QWEN_API_KEY=your_qwen_api_key_here
QWEN_MODEL=qwen-image-edit-plus
QWEN_API_URL=https://dashscope.aliyuncs.com/api/v1/services/aigc/multimodal-generation/generation

# 或使用 Stability AI（备选）
STABILITY_API_KEY=your_stability_api_key_here

# 或使用 OpenAI DALL-E（备选，仅生成新图像）
OPENAI_API_KEY=your_openai_api_key_here

# 服务器端口（可选，默认 5000）
PORT=5000
```

### 4. 获取 API 密钥

#### 通义千问（推荐）
1. 访问 [阿里云百炼控制台](https://bailian.console.aliyun.com/)
2. 注册/登录阿里云账号
3. 开通通义千问服务
4. 创建 API 密钥

#### Stability AI
1. 访问 [Stability AI 平台](https://platform.stability.ai/)
2. 注册账号并获取 API 密钥

#### OpenAI
1. 访问 [OpenAI 平台](https://platform.openai.com/)
2. 创建 API 密钥

## 🚀 启动项目

### 开发模式（推荐）

```bash
npm run dev
```

使用 `nodemon`，代码修改后自动重启。

### 生产模式

```bash
npm start
```

### 访问应用

打开浏览器访问：`http://localhost:5000`

## 📖 使用指南

### 基本流程

1. **上传房间照片**
   - 点击上传区域或拖拽图片
   - 支持常见图片格式（JPG、PNG 等）

2. **步骤 1：场景分析**
   - AI 自动分析房间类型、现有物品
   - 识别杂乱物品清单
   - 生成改进建议

3. **步骤 2：基础清理**（自动执行）
   - 移除明显垃圾和杂物
   - 保留所有大件物品（显示器、主机、家具等）

4. **步骤 3：深度整理**（自动执行）
   - 清理墙面贴纸、海报
   - 清理桌面、地面污渍
   - 整理电线、数据线

5. **步骤 4：布局优化**（自动执行）
   - 优化物品摆放
   - 提升空间利用率

6. **步骤 5：添加道具**（需要用户输入）
   - 输入场景描述（如：学习角落、玩偶拍摄等）
   - 可选：指定具体道具（如：一本书、一盏台灯）
   - AI 根据场景添加专业道具

### 重新清理功能

如果对清理结果不满意，可以点击"重新清理"按钮：
- AI 会理解这是重新清理操作
- 会更彻底地识别和清理凌乱物品
- 包括之前可能遗漏的物品

## 🏗️ 项目结构

```
app-image-maker/
├── server.js              # Express 服务器主文件
├── prompt-template.js      # AI Prompt 模板
├── app.js                 # 前端 JavaScript
├── index.html             # 前端 HTML
├── package.json           # 项目配置
├── .env                   # 环境变量（需自行创建）
├── API配置说明.md         # API 配置详细说明
└── README.md             # 项目说明文档
```

## 🔧 核心功能实现

### 五步处理流程

```
┌─────────────┐
│  上传图片    │
└──────┬──────┘
       │
       ▼
┌─────────────────┐
│ 步骤1: 场景分析  │ ──→ 识别杂乱物品清单
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│ 步骤2: 基础清理  │ ──→ 移除明显垃圾
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│ 步骤3: 深度整理  │ ──→ 清理贴纸、污渍
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│ 步骤4: 布局优化  │ ──→ 优化物品摆放
└──────┬──────────┘
       │
       ▼
┌─────────────────┐
│ 步骤5: 添加道具  │ ──→ 根据场景添加道具
└─────────────────┘
```

### 杂乱物品识别机制

1. **场景分析阶段**：AI 识别并列出所有杂乱物品，说明为什么它们被认为是杂乱的
2. **清理阶段**：基于杂乱物品清单进行清理
3. **后续阶段**：禁止已清理的杂乱物品重新出现
4. **智能协调**：如果用户明确指定要添加某个物品（如"一个水杯"），允许添加整洁、协调的新物品

### Prompt 工程

项目使用精心设计的 Prompt 模板，确保 AI 能够：
- 准确识别杂乱物品
- 保留重要的大件物品（显示器、主机、家具等）
- 不添加不需要的物品
- 理解重新清理的需求

## 📝 API 说明

### POST `/api/enhance-room`

处理房间改造请求。

**请求参数：**
- `image` (File): 房间照片文件
- `step` (String): 处理步骤（1-5）
- `scenario` (String, 可选): 场景描述（步骤 5 必需）
- `props` (String, 可选): 指定道具（步骤 5 可选）
- `previousImageUrl` (String, 可选): 上一步的结果图片 URL
- `clutterList` (String, 可选): 杂乱物品清单
- `isRedo` (Boolean, 可选): 是否是重新清理

**响应：**
- 步骤 1：返回文本分析结果
- 步骤 2-5：返回处理后的图片 URL

## 🎨 UI 特性

- **科技简约风格**：深色背景、玻璃态效果、霓虹色强调
- **响应式设计**：适配不同屏幕尺寸
- **拖拽上传**：支持拖拽图片上传
- **实时反馈**：加载状态、步骤指示器
- **结果对比**：每步结果清晰展示

## ⚙️ 配置选项

### 环境变量

| 变量名 | 说明 | 必需 | 默认值 |
|--------|------|------|--------|
| `QWEN_API_KEY` | 通义千问 API 密钥 | 是* | - |
| `QWEN_MODEL` | 通义千问模型 | 否 | `qwen-image-edit-plus` |
| `QWEN_API_URL` | 通义千问 API 地址 | 否 | 默认地址 |
| `STABILITY_API_KEY` | Stability AI 密钥 | 否 | - |
| `OPENAI_API_KEY` | OpenAI 密钥 | 否 | - |
| `PORT` | 服务器端口 | 否 | `5000` |

*至少需要配置一个 AI 服务的 API 密钥

## 🐛 故障排除

### 常见问题

1. **API 调用失败**
   - 检查 `.env` 文件中的 API 密钥是否正确
   - 确认 API 密钥有足够的余额/配额
   - 查看服务器控制台的详细错误信息

2. **图片上传失败**
   - 检查图片格式是否支持
   - 确认图片大小不超过限制

3. **端口被占用**
   - 修改 `.env` 中的 `PORT` 值
   - 或关闭占用端口的其他程序

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

MIT License

## 🙏 致谢

- [通义千问](https://tongyi.aliyun.com/) - AI 图像编辑服务
- [Stability AI](https://stability.ai/) - AI 图像生成服务
- [OpenAI](https://openai.com/) - DALL-E 图像生成服务

## 📧 联系方式

如有问题或建议，请提交 Issue。

---

**注意**：本项目需要有效的 AI API 密钥才能使用。请确保在使用前配置好相应的 API 密钥。

